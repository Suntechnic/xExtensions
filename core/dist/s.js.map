{"version":3,"file":"s.js","sources":["../src/core.js"],"sourcesContent":["import {loader as loaderVue} from 'x.vue.loader';\n\nexport const ControllersInstances = {};\n\nexport const core = {\n\n    Controller: class {\n        constructor (node,code,options) {\n\n            // получаем ноду\n            if (typeof node == 'string') {\n                let selector = node;\n                node = document.querySelector(selector);\n                if (!node) console.error('Invalid selector',selector);\n            }\n            if (!node) {\n                console.error('Invalid node for controller');\n                return null;\n            } \n\n            // если ноде уже назначен идентификатор контролера\n            if (node.dataset?.controller && ControllersInstances[node.dataset.controller]) {\n            return ControllersInstances[node.dataset.controller]; // возвращем его\n            }\n\n            // регистрируем контроллер этой ноды\n\n            this.node = node; // назначаем ноду в контролер\n            code = code || '';\n            this.uid = code+'_'+(Math.floor(Math.random() * 10000000));\n            while (ControllersInstances[this.uid]) {\n                this.uid = code+'_'+(Math.floor(Math.random() * 10000000));\n            }\n            \n            ControllersInstances[this.uid] = this;\n            node.dataset.controller = this.uid;\n\n            return this.init(options || {});\n        }\n        init () {}\n    },\n\n}\n\nexport const ajax = {\n\n    cache: {},\n    runAction (action,config,cacheTTL) {\n        cacheTTL = parseInt(cacheTTL) || 0;\n        let promise = new Promise((resolve, reject) => {\n\n                if (cacheTTL) {\n                    let hash = BX.md5(action + JSON.stringify(config));\n\n                    if (this.cache[hash]) {\n                        resolve(JSON.parse(this.cache[hash]));\n                        return;\n                    }\n\n                    BX.ajax.runAction(action, config).then((response) => {\n                            this.cache[hash] = JSON.stringify(response);\n                            setTimeout(()=>{\n                                    delete this.cache[hash];\n                                },cacheTTL*1000);\n                            resolve(response);\n\n                        }, reject);\n                } else {\n                    BX.ajax.runAction(action, config).then(resolve, reject);\n                }\n            })\n\n        return promise;\n    }\n}\n\nconsole.time('x.core.load');\nwindow.addEventListener('load', ()=>{\n    BX.ready(() => {\n            BX.onCustomEvent('x.core:loaded');\n            console.timeEnd('x.core.load');\n\n            loaderVue.init();\n\n            BX.onCustomEvent('x.core:inited');\n        });\n});"],"names":["ControllersInstances","core","Controller","node","code","options","selector","document","querySelector","console","error","dataset","controller","uid","Math","floor","random","init","ajax","cache","runAction","action","config","cacheTTL","parseInt","promise","Promise","resolve","reject","hash","BX","md5","JSON","stringify","parse","then","response","setTimeout","time","window","addEventListener","ready","onCustomEvent","timeEnd","loaderVue"],"mappings":"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"}