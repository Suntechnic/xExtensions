{"version":3,"file":"s.js","sources":["../src/core.js"],"sourcesContent":["import {loader as loaderVue} from 'x.vue.loader';\n\nexport const ControllersInstances = {};\n\nexport const core = {\n\n    Controller: class {\n        constructor (node,code) {\n\n            // получаем ноду\n            if (typeof node == 'string') {\n                let selector = node;\n                node = document.querySelector(selector);\n                if (!node) console.error('Invalid selector',selector);\n            }\n            if (!node) {\n                console.error('Invalid node for controller');\n                return null;\n            } \n\n            // если ноде уже назначен идентификатор контролера\n            if (node.dataset?.controller && ControllersInstances[node.dataset.controller]) {\n            return ControllersInstances[node.dataset.controller]; // возвращем его\n            }\n\n            // регистрируем контроллер этой ноды\n\n            this.node = node; // назначаем ноду в контролер\n            code = code || '';\n            this.uid = code+'_'+(Math.floor(Math.random() * 10000000));\n            while (ControllersInstances[this.uid]) {\n                this.uid = code+'_'+(Math.floor(Math.random() * 10000000));\n            }\n            \n            ControllersInstances[this.uid] = this;\n            node.dataset.controller = this.uid;\n\n            return this.init();\n        }\n        init () {}\n    },\n\n}\n\nexport const ajax = {\n\n    cache: {\n        \n    },\n\n    runAction (action,config,cacheTTL) {\n        cacheTTL = parseInt(cacheTTL) || 0;\n        let promise = new Promise((resolve, reject) => {\n\n                if (cacheTTL) {\n                    let hash = BX.md5(action + JSON.stringify(config));\n\n                    if (this.cache[hash]) {\n                        resolve(JSON.parse(this.cache[hash]));\n                        return;\n                    }\n\n                    BX.ajax.runAction(action, config).then((response) => {\n                            this.cache[hash] = JSON.stringify(response);\n                            setTimeout(()=>{\n                                    delete this.cache[hash];\n                                },cacheTTL*1000);\n                            resolve(response);\n\n                        }, reject);\n                } else {\n                    BX.ajax.runAction(action, config).then(resolve, reject);\n                }\n            })\n\n        return promise;\n    }\n}\n\nconsole.time('x.core.load');\nwindow.addEventListener('load', ()=>{\n    BX.ready(() => {\n            BX.onCustomEvent('x.core:loaded');\n            console.timeEnd('x.core.load');\n\n            loaderVue.init();\n\n            BX.onCustomEvent('x.core:inited');\n        });\n});"],"names":["ControllersInstances","core","Controller","node","code","_node$dataset","babelHelpers","classCallCheck","selector","document","querySelector","console","error","dataset","controller","uid","Math","floor","random","init","createClass","key","value","ajax","cache","runAction","action","config","cacheTTL","_this","parseInt","promise","Promise","resolve","reject","hash","BX","md5","JSON","stringify","parse","then","response","setTimeout","time","window","addEventListener","ready","onCustomEvent","timeEnd","loaderVue"],"mappings":"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"}