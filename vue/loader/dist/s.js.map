{"version":3,"file":"s.js","sources":["../src/loader.js"],"sourcesContent":["import {BitrixVue} from 'ui.vue3';\n\n/*\n* автозагрузка vue компонентов\n* Загрузчик создает экземпляры приложений и помещает их в списки находящиеся в BX.X.Vue.Apps,\n* именуя ключи как App{ИмяКорневогоКомпонента}\n*\n* Для создания слота монтирования на страниц необходимо создать тег вида:\n* <div vue=\"ИмяКорневогоКомпонента\" data-имяПропса=\"значениеПропса\"></div>\n* например для отбражения кнопок добавления товара 229353 в списки избранного и сравнения:\n* <div vue=\"ListsButton\" data-list=\"compare,favorites\" data-productid=\"229353\"></div>\n*\n* Если необходимо передать в компонент сложные данные, это можно сделать через инъекцию,\n* для этого необходимо данные json поместить во внутрь слота, в токен script c name=КлючИнъекции\n* Например для формы оформления заказа:\n\n    <section class=\"order\" vue=\"Order\">\n        <script type=\"application/json\" name=\"initdata\">\n            {\"ajaxUrl\":\"\\/bitrix\\/components\\/bitrix\\/sale.order.ajax\\/ajax.php\",\"hashBasket\":\"fda088cce0595233895f37519d3d68c5\"}\n        </script>\n    </section>\n\n*\n* Данные будут доступны в компоненте, в инъекции с ключом name.\n* В примере выше:\n\n    inject: ['initdata'],\n    created () {\n            // переносим инициализационные данные\n            this.hashBasket = this.initdata.hashBasket;\n            this.arResult = this.initdata.arResult;\n        },\n\n*\n* Нужно иметь ввиду что данный ключ не может быть root - такой ключ зарезервирован для инхъекции данных о корневом приложении\n*\n* Елси какие-то участки html-кода подгружены после события BX.ready, например по ajax,\n* или созданы другим образом и содержат компоненты которые нужно инициализировать,\n* то после их добавления необходимо вызвать событие x.vue.loader:initVue:\n\n    BX.onCustomEvent('x.vue.loader:initVue');\n\n* \n*/\n\n\n// функция инициализации\nexport const init = (node) => {\n        //console.log('initVue', node);\n        \n        node = node || document\n        node.querySelectorAll('[vue]').forEach((elm) => {\n            \n                let ComponentName = elm.getAttribute('vue');\n                \n                let AppName = 'App'+ComponentName;\n                if (typeof BX.X.Vue.Apps == 'undefined') BX.X.Vue.Apps = {};\n                if (typeof BX.X.Vue.Apps[AppName] == 'undefined') BX.X.Vue.Apps[AppName] = [];\n                \n                if (BX.X.Vue.Components[ComponentName]) {\n                    let datasetAttrs = '';\n                    for (let name in elm.dataset) {\n                        datasetAttrs = datasetAttrs+' '+name+'=\"'+elm.dataset[name]+'\"';\n                    }\n                    let template = '<'+ComponentName+datasetAttrs+'/>';\n                    \n                    const components = {};\n                    \n                    components[ComponentName] = BX.X.Vue.Components[ComponentName];\n                    const application = BX.Vue3.BitrixVue.createApp({\n                            name: AppName,\n                            components: components,\n                            template: template\n                        });\n                    \n                    //application.use(store);\n                    \n                    // предоставляем данные json\n                    let jsonElms = elm.querySelectorAll('[type=\"extension/settings\"][name]');\n                    jsonElms.forEach((jsonElm)=>{\n                            application.provide(jsonElm.getAttribute('name'),JSON.parse(jsonElm.innerText));\n                        });\n                    \n                    // предоставляем данные о приложении\n                    application.provide('root',{\n                            'application': application,\n                            'name': AppName,\n                            'index': BX.X.Vue.Apps[AppName].length\n                        });\n                \n                    \n                    // удаляем для избежания повторного монтирования\n                    elm.removeAttribute('vue');\n                    if (!elm.getAttribute('vue')) {\n                        application.mount(elm);\n                        BX.X.Vue.Apps[AppName].push(application);\n                    } else {\n                        console.error('ERROR premounted!');\n                    }\n                    \n                    \n                    \n                } else console.error('Component '+ComponentName+' not exists');\n            })\n    };\n\n// внутреннее событие перестройки DOM\nBX.addCustomEvent('x.vue.loader:initVue' , init); //BX.onCustomEvent('x.vue.loader:initVue');\n\n// поддержка композита\nif (window.frameCacheVars !== undefined) {\n    BX.addCustomEvent('onFrameDataReceived' , init);\n}\n\n"],"names":["init","node","document","querySelectorAll","forEach","elm","ComponentName","getAttribute","AppName","BX","X","Vue","Apps","Components","datasetAttrs","name","dataset","template","components","application","Vue3","BitrixVue","createApp","jsonElms","jsonElm","provide","JSON","parse","innerText","length","removeAttribute","mount","push","console","error","addCustomEvent","window","frameCacheVars","undefined"],"mappings":"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"}